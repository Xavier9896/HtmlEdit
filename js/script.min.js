$(function(){
	'use strict';
	var htmlcode="<!DOCTYPE html>\n<html>\n<head>\n<meta charset=\"utf-8\">\n<title>文档标题</title>\n</head>\n<body>\n\t<h1>我的第一个HTML页面</h1>\n\t<p>我的第一个段落。</p>\n</body>\n</html>";
	$("#sourcecode").val(htmlcode);
	$("#sourcecode").keyup();
	$("#send").click(function(){
		var ifr=document.createElement("iframe");
		ifr.setAttribute("frameborder","0");
		ifr.setAttribute("id","iframeResult");
		ifr.setAttribute("srcdoc",$("#sourcecode").val());
		document.getElementById("resText").innerHTML="";
		document.getElementById("resText").appendChild(ifr);
		/*$("#resText").html("");
		$("#resText").append($("#sourcecode").val());*/
	}).click();
	$("#demo").click(function(){
		$("#sourcecode").val(htmlcode);
		$("#sourcecode").focus();
		$("#send").click();
	});
	/**添加扩展库方法*/
	$("ul.dropdown-menu li").click(function(){
		var pattern=/<head>/;
		if (pattern.test($("#sourcecode").val())) {
			var arr=$("#sourcecode").val().split(/<head>/);
			if ($(this).index()==0) {
				$("#sourcecode").val(arr[0]
					+'<head>\n'
					+'<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>'
					+arr[1]);
			}else if($(this).index()==1){
				$("#sourcecode").val(arr[0]
					+'<head>\n'
					+'<link href="https://cdn.bootcss.com/twitter-bootstrap/3.4.0/css/bootstrap.min.css" rel="stylesheet">\n'
					+'<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>\n'
					+'<script src="https://cdn.bootcss.com/twitter-bootstrap/3.4.0/js/bootstrap.min.js"></script>'
					+arr[1]);
			}else if ($(this).index()==2) {
				$("#sourcecode").val(arr[0]
					+'<head>\n'
					+'<script src="https://cdn.bootcss.com/vue/2.6.4/vue.min.js"></script>'
					+arr[1]);
			}
		}else {
			if ($(this).index()==0) {
				$("#sourcecode").val('<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>'+$("#sourcecode").val());
			}else if($(this).index()==1){
				$("#sourcecode").val('<link href="https://cdn.bootcss.com/twitter-bootstrap/3.4.0/css/bootstrap.min.css" rel="stylesheet">\n'
				+'<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>\n'
				+'<script src="https://cdn.bootcss.com/twitter-bootstrap/3.4.0/js/bootstrap.min.js"></script>\n'
				+$("#sourcecode").val());
			}else if ($(this).index()==2) {
				$("#sourcecode").val('<script src="https://cdn.bootcss.com/vue/2.6.4/vue.min.js"></script>\n'+$("#sourcecode").val());
			}
		}
		$("#send").click();
	});
	/**textarea制表符按键监听，实现制表符功能，而不是跳转下一个组件*/
	$("#sourcecode").keydown(function(e){
		if (e.keyCode==9) {
			var selectionStart=e.target.selectionStart;
			$("#sourcecode").val($(this).val().substr(0,selectionStart)
			+"	"
			+$(this).val().substr(selectionStart));
			var $textareaselect=$(this);
			e.preventDefault();
			$textareaselect[0].setSelectionRange(selectionStart+1,selectionStart+1);
		}
	});
	$("#sourcecode").keyup(function(e){
		$("#send").click();
	})
});
